"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _ = require("lodash");
const joins = require("lodash-joins");
/**
 * 這個class就是幫你處理Data的後處理
 * Large是指超過一千筆資料
 * 普通就是大概100筆左右
 * @export
 * @class DataHelper
 */
class BaseDataHelper {
    static OuterJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashFullOuterJoin(aData, acc, bData, acc);
    }
    static OuterJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeFullOuterJoin(aData, acc, bData, acc);
    }
    static InnerJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashInnerJoin(aData, acc, bData, acc);
    }
    static InnerJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeInnerJoin(aData, acc, bData, acc);
    }
    static Existy(x) {
        return x !== undefined;
    }
    static Merge(aData, bData) {
        return _.assign({}, aData, bData);
    }
    static MergeList(...aData) {
        return _.reduce(aData, (sum, next) => {
            return this.Merge(sum, next);
        });
    }
    static Max(aData, key) {
        return _.maxBy(aData, key);
    }
    static Min(aData, key) {
        return _.minBy(aData, key);
    }
    static Sum(aData, key) {
        return _.sumBy(aData, key);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static RightJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeRightOuterJoin(aData, acc, bData, acc);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static LeftJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashLeftOuterJoin(aData, acc, bData, acc);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static RightJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashRightOuterJoin(aData, acc, bData, acc);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static LeftJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeLeftOuterJoin(aData, acc, bData, acc);
    }
    static IntToBoolean(data, fields, toTrue = 1) {
        if (_.isEmpty(data)) {
            return {};
        }
        _.forEach(fields, (key) => {
            if (!_.isUndefined(data[key])) {
                _.toSafeInteger(data[key]) === toTrue ?
                    data[key] = true :
                    data[key] = false;
            }
        });
        return data;
    }
    static IntMoreToBoolean(data, fields, toTrue = 0) {
        if (_.isEmpty(data)) {
            return {};
        }
        _.forEach(fields, (key) => {
            if (!_.isUndefined(data[key])) {
                _.toSafeInteger(data[key]) === toTrue ?
                    data[key] = false :
                    data[key] = true;
            }
        });
        return data;
    }
    static BooleanToInt(data, fields) {
        if (_.isEmpty(data)) {
            return {};
        }
        _.forEach(fields, (key) => {
            if (!_.isUndefined(data[key])) {
                data[key] === true ?
                    data[key] = 1 :
                    data[key] = 0;
            }
        });
        return data;
    }
}
exports.default = BaseDataHelper;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmFzZURhdGFIZWxwZXIuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJ1dGlscy9CYXNlRGF0YUhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDRCQUE0QjtBQUM1QixzQ0FBc0M7QUFNdEM7Ozs7OztHQU1HO0FBQ0gsTUFBcUIsY0FBYztJQUN4QixNQUFNLENBQUMsU0FBUyxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsR0FBYTtRQUM3RCxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFDTSxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsR0FBYTtRQUNsRSxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDLHdCQUF3QixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFDTSxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsR0FBYTtRQUM3RCxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBQ00sTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFZLEVBQUUsS0FBWSxFQUFFLEdBQWE7UUFDbEUsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQztRQUN2QixPQUFPLEtBQUssQ0FBQyxvQkFBb0Is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RSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUMzQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7b0JBQ2hCLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDZixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3JCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0NBQ0o7QUE1SEQsaUNBNEhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICogYXMgam9pbnMgZnJvbSAnbG9kYXNoLWpvaW5zJztcblxuZXhwb3J0IGludGVyZmFjZSBJRlMge1xuICAgIGZpZWxkOiBzdHJpbmdbXSB8IHVuZGVmaW5lZDtcbiAgICBub2xvY2s6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG59XG4vKipcbiAqIOmAmeWAi2NsYXNz5bCx5piv5bmr5L2g6JmV55CGRGF0YeeahOW+jOiZleeQhlxuICogTGFyZ2XmmK/mjIfotoXpgY7kuIDljYPnrYbos4fmlplcbiAqIOaZrumAmuWwseaYr+Wkp+amgjEwMOethuW3puWPs1xuICogQGV4cG9ydFxuICogQGNsYXNzIERhdGFIZWxwZXJcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmFzZURhdGFIZWxwZXIge1xuICAgIHB1YmxpYyBzdGF0aWMgT3V0ZXJKb2luKGFEYXRhOiBhbnlbXSwgYkRhdGE6IGFueVtdLCBrZXk6IHN0cmluZ1tdKSB7XG4gICAgICAgIGNvbnN0IGFjYyA9IChhKSA9PiBrZXk7XG4gICAgICAgIHJldHVybiBqb2lucy5oYXNoRnVsbE91dGVySm9pbihhRGF0YSwgYWNjLCBiRGF0YSwgYWNjKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBPdXRlckpvaW5MYXJnZShhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuc29ydGVkTWVyZ2VGdWxsT3V0ZXJKb2luKGFEYXRhLCBhY2MsIGJEYXRhLCBhY2MpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIElubmVySm9pbihhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuaGFzaElubmVySm9pbihhRGF0YSwgYWNjLCBiRGF0YSwgYWNjKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBJbm5lckpvaW5MYXJnZShhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuc29ydGVkTWVyZ2VJbm5lckpvaW4oYURhdGEsIGFjYywgYkRhdGEsIGFjYyk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRXhpc3R5KHgpIHtcbiAgICAgICAgcmV0dXJuIHggIT09IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBNZXJnZShhRGF0YTogYW55LCBiRGF0YTogYW55KSB7XG4gICAgICAgIHJldHVybiBfLmFzc2lnbih7fSwgYURhdGEsIGJEYXRhKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBNZXJnZUxpc3QoLi4uYURhdGE6IGFueVtdKSB7XG4gICAgICAgIHJldHVybiBfLnJlZHVjZShhRGF0YSwgKHN1bSwgbmV4dCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuTWVyZ2Uoc3VtLCBuZXh0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTWF4KGFEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIF8ubWF4QnkoYURhdGEsIGtleSk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTWluKGFEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIF8ubWluQnkoYURhdGEsIGtleSk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgU3VtKGFEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIF8uc3VtQnkoYURhdGEsIGtleSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIOmAmeWAi+aYr+WPluWHuuebuOWQjOeahEtleeaykuacieeahG51bGxcbiAgICAgKiBAcGFyYW0ge2FueVtdfSBhRGF0YSDlt6ZcbiAgICAgKiBAcGFyYW0ge2FueVtdfSBiRGF0YSDlj7NcbiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBrZXkg55u45ZCM55qEa2V5XG4gICAgICogQHJldHVybnMg5ZCI5L216YGO55qE6Zmj5YiXXG4gICAgICogQG1lbWJlcm9mIERhdGFIZWxwZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIFJpZ2h0Sm9pbkxhcmdlKGFEYXRhOiBhbnlbXSwgYkRhdGE6IGFueVtdLCBrZXk6IHN0cmluZ1tdKSB7XG4gICAgICAgIGNvbnN0IGFjYyA9IChhKSA9PiBrZXk7XG4gICAgICAgIHJldHVybiBqb2lucy5zb3J0ZWRNZXJnZVJpZ2h0T3V0ZXJKb2luKGFEYXRhLCBhY2MsIGJEYXRhLCBhY2MpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDpgJnlgIvmmK/lj5blh7rnm7jlkIznmoRLZXnmspLmnInnmoRudWxsXG4gICAgICogQHBhcmFtIHthbnlbXX0gYURhdGEg5bemXG4gICAgICogQHBhcmFtIHthbnlbXX0gYkRhdGEg5Y+zXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5IOebuOWQjOeahGtleVxuICAgICAqIEByZXR1cm5zIOWQiOS9temBjueahOmZo+WIl1xuICAgICAqIEBtZW1iZXJvZiBEYXRhSGVscGVyXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBMZWZ0Sm9pbihhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuaGFzaExlZnRPdXRlckpvaW4oYURhdGEsIGFjYywgYkRhdGEsIGFjYyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIOmAmeWAi+aYr+WPluWHuuebuOWQjOeahEtleeaykuacieeahG51bGxcbiAgICAgKiBAcGFyYW0ge2FueVtdfSBhRGF0YSDlt6ZcbiAgICAgKiBAcGFyYW0ge2FueVtdfSBiRGF0YSDlj7NcbiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBrZXkg55u45ZCM55qEa2V5XG4gICAgICogQHJldHVybnMg5ZCI5L216YGO55qE6Zmj5YiXXG4gICAgICogQG1lbWJlcm9mIERhdGFIZWxwZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIFJpZ2h0Sm9pbihhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuaGFzaFJpZ2h0T3V0ZXJKb2luKGFEYXRhLCBhY2MsIGJEYXRhLCBhY2MpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDpgJnlgIvmmK/lj5blh7rnm7jlkIznmoRLZXnmspLmnInnmoRudWxsXG4gICAgICogQHBhcmFtIHthbnlbXX0gYURhdGEg5bemXG4gICAgICogQHBhcmFtIHthbnlbXX0gYkRhdGEg5Y+zXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5IOebuOWQjOeahGtleVxuICAgICAqIEByZXR1cm5zIOWQiOS9temBjueahOmZo+WIl1xuICAgICAqIEBtZW1iZXJvZiBEYXRhSGVscGVyXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBMZWZ0Sm9pbkxhcmdlKGFEYXRhOiBhbnlbXSwgYkRhdGE6IGFueVtdLCBrZXk6IHN0cmluZ1tdKSB7XG4gICAgICAgIGNvbnN0IGFjYyA9IChhKSA9PiBrZXk7XG4gICAgICAgIHJldHVybiBqb2lucy5zb3J0ZWRNZXJnZUxlZnRPdXRlckpvaW4oYURhdGEsIGFjYywgYkRhdGEsIGFjYyk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgSW50VG9Cb29sZWFuKGRhdGE6IGFueSwgZmllbGRzOiBzdHJpbmdbXSwgdG9UcnVlID0gMSkge1xuICAgICAgICBpZiAoXy5pc0VtcHR5KGRhdGEpKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgXy5mb3JFYWNoKGZpZWxkcywgKGtleSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGRhdGFba2V5XSkpIHtcbiAgICAgICAgICAgICAgICBfLnRvU2FmZUludGVnZXIoZGF0YVtrZXldKSA9PT0gdG9UcnVlID9cbiAgICAgICAgICAgICAgICAgICAgZGF0YVtrZXldID0gdHJ1ZSA6XG4gICAgICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgSW50TW9yZVRvQm9vbGVhbihkYXRhOiBhbnksIGZpZWxkczogc3RyaW5nW10sIHRvVHJ1ZSA9IDApIHtcbiAgICAgICAgaWYgKF8uaXNFbXB0eShkYXRhKSkge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIF8uZm9yRWFjaChmaWVsZHMsIChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkYXRhW2tleV0pKSB7XG4gICAgICAgICAgICAgICAgXy50b1NhZmVJbnRlZ2VyKGRhdGFba2V5XSkgPT09IHRvVHJ1ZSA/XG4gICAgICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IGZhbHNlIDpcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtrZXldID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEJvb2xlYW5Ub0ludChkYXRhOiBhbnksIGZpZWxkczogc3RyaW5nW10pIHtcbiAgICAgICAgaWYgKF8uaXNFbXB0eShkYXRhKSkge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIF8uZm9yRWFjaChmaWVsZHMsIChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkYXRhW2tleV0pKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtrZXldID09PSB0cnVlID9cbiAgICAgICAgICAgICAgICAgICAgZGF0YVtrZXldID0gMSA6XG4gICAgICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG59XG4iXX0=