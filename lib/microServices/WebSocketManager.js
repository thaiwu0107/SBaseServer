"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const log4js = require("koa-log4");
require("reflect-metadata");
const WebSocketContext_1 = require("../models/WebSocketContext");
const _log = log4js.getLogger('WebSocketManager');
class WebSocketManager {
    constructor() {
        this._context = WebSocketContext_1.default.getInstance().getWebsocket();
        this._context.on('connection', (ws, req, head) => {
            this._ows = ws;
            console.log(req.connection.remoteAddress);
        });
        this._ows.on('open', function open() {
            console.log('connected');
        });
        this._ows.on('close', function close() {
            console.log('disconnected');
        });
        this._ows.on('message', function incoming(data) {
            console.log(`Roundtrip time: ${Date.now() - data} ms`);
        });
    }
}
exports.default = WebSocketManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0TWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIuL3NyYy8iLCJzb3VyY2VzIjpbIm1pY3JvU2VydmljZXMvV2ViU29ja2V0TWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFtQztBQUNuQyw0QkFBMEI7QUFFMUIsaUVBQTBEO0FBRTFELE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNsRCxNQUFxQixnQkFBZ0I7SUFHakM7UUFDSSxJQUFJLENBQUMsUUFBUSxHQUFHLDBCQUFnQixDQUFDLFdBQVcsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzlELElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUU7WUFDN0MsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7WUFDZixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxJQUFJO1lBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsU0FBUyxLQUFLO1lBQ2hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxRQUFRLENBQUMsSUFBSTtZQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxLQUFLLENBQUMsQ0FBQztRQUMzRCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSjtBQW5CRCxtQ0FtQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBsb2c0anMgZnJvbSAna29hLWxvZzQnO1xuaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcbmltcG9ydCAqIGFzIFdlYlNvY2tldCBmcm9tICd3cyc7XG5pbXBvcnQgV2ViU29ja2V0Q29udGV4dCBmcm9tICcuLi9tb2RlbHMvV2ViU29ja2V0Q29udGV4dCc7XG5cbmNvbnN0IF9sb2cgPSBsb2c0anMuZ2V0TG9nZ2VyKCdXZWJTb2NrZXRNYW5hZ2VyJyk7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWJTb2NrZXRNYW5hZ2VyIHtcbiAgICBwcm90ZWN0ZWQgX2NvbnRleHQ6IFdlYlNvY2tldC5TZXJ2ZXI7XG4gICAgcHJvdGVjdGVkIF9vd3M6IFdlYlNvY2tldC5TZXJ2ZXI7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQgPSBXZWJTb2NrZXRDb250ZXh0LmdldEluc3RhbmNlKCkuZ2V0V2Vic29ja2V0KCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQub24oJ2Nvbm5lY3Rpb24nLCAod3MsIHJlcSwgaGVhZCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fb3dzID0gd3M7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXEuY29ubmVjdGlvbi5yZW1vdGVBZGRyZXNzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX293cy5vbignb3BlbicsIGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY29ubmVjdGVkJyk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9vd3Mub24oJ2Nsb3NlJywgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZGlzY29ubmVjdGVkJyk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9vd3Mub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiBpbmNvbWluZyhkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgUm91bmR0cmlwIHRpbWU6ICR7RGF0ZS5ub3coKSAtIGRhdGF9IG1zYCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==