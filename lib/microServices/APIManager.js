"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const log4js = require("koa-log4");
const _ = require("lodash");
require("reflect-metadata");
const request_1 = require("request");
const util_1 = require("util");
const CAHttpsContext_1 = require("../models/CAHttpsContext");
const _log = log4js.getLogger('APIManger');
class APIManger {
    constructor() {
        this.agentOptions = undefined;
        const caData = CAHttpsContext_1.default.getInstance().getCA();
        if (!_.isUndefined(caData)) {
            this.agentOptions = _.isUndefined(caData.cadata) ? undefined : _.omitBy(caData.cadata, _.isUndefined);
            this.auth = _.isUndefined(caData.authData) ? undefined : _.omitBy(caData.authData, _.isUndefined);
        }
        const [getPm, postPm, patchPm, deletePm, putPm] = [request_1.get, request_1.post, request_1.patch, request_1.del, request_1.put].map(util_1.promisify);
        this.get = getPm;
        this.post = postPm;
        this.patch = patchPm;
        this.del = deletePm;
        this.put = putPm;
    }
    /**
     * httpGet
     */
    async httpGet(url, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.get(reqData);
    }
    /**
     * httpsGet
     */
    async httpsGet(url, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.get(reqData);
    }
    /**
     * httpPost
     */
    async httpPost(url, requestBody, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData,
            json: true,
            body: JSON.stringify(requestBody)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.post(reqData);
    }
    /**
     * httpsPost
     */
    async httpsPost(url, requestBody, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined),
            json: true, body: JSON.stringify(requestBody)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.post(reqData);
    }
    /**
     * httpPostFormData
     */
    async httpPostFormData(url, formData, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData,
            formData
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.post(reqData);
    }
    /**
     * httpsPostFormData
     */
    async httpsPostFormData(url, formData, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined),
            formData
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.post(reqData);
    }
    /**
     * httpPut
     */
    async httpPut(url, requestBody, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData,
            json: true,
            body: JSON.stringify(requestBody)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.put(reqData);
    }
    /**
     * httpsPut
     */
    async httpsPut(url, requestBody, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined),
            json: true, body: JSON.stringify(requestBody)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.put(reqData);
    }
    /**
     * httpPutFormData
     */
    async httpPutFormData(url, formData, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData,
            formData
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.put(reqData);
    }
    /**
     * httpsPut
     */
    async httpsPutFormData(url, formData, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined), formData
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.put(reqData);
    }
    /**
     * httpPatch
     */
    async httpPatch(url, requestBody, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData,
            json: true,
            body: JSON.stringify(requestBody)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.patch(reqData);
    }
    /**
     * httpsPatch
     */
    async httpsPatch(url, requestBody, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined),
            json: true, body: JSON.stringify(requestBody)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.patch(reqData);
    }
    /**
     * httpDelete
     */
    async httpDelete(url, params, authData) {
        const baseData = {
            url: 'http://' + url,
            auth: _.isUndefined(authData) ? this.auth : authData
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.del(reqData);
    }
    /**
     * httpsDelete
     */
    async httpsDelete(url, params, cadata) {
        const baseData = {
            url: 'http://' + url,
            agentOptions: _.isUndefined(cadata) ? this.agentOptions : _.omitBy(cadata, _.isUndefined)
        };
        const reqData = _.isUndefined(params) ? baseData : _.assign(baseData, { qs: params });
        return this.del(reqData);
    }
}
exports.default = APIManger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQVBJTWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIuL3NyYy8iLCJzb3VyY2VzIjpbIm1pY3JvU2VydmljZXMvQVBJTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFtQztBQUNuQyw0QkFBNEI7QUFDNUIsNEJBQTBCO0FBQzFCLHFDQUFxRDtBQUNyRCwrQkFBaUM7QUFDakMsNkRBQXNEO0FBRXRELE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDM0MsTUFBcUIsU0FBUztJQW9CMUI7UUFuQlEsaUJBQVksR0FPaEIsU0FBUyxDQUFDO1FBYVYsTUFBTSxNQUFNLEdBQUcsd0JBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdEcsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3JHO1FBQ0QsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLGFBQUcsRUFBRSxjQUFJLEVBQUUsZUFBSyxFQUFFLGFBQUcsRUFBRSxhQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMs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LENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVE7U0FDdkQsQ0FBQztRQUNGLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUN0RixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNEOztPQUVHO0lBQ0ksS0FBSyxDQUFDLFdBQVcsQ0FDcEIsR0FBVyxFQUFFLE1BQVksRUFDekIsTUFPQztRQUNELE1BQU0sUUFBUSxHQUFHO1lBQ2IsR0FBRyxFQUFFLFNBQVMsR0FBRyxHQUFHO1lBQ3BCLFlBQVksRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDO1NBQzVGLENBQUM7UUFDRixNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDdEYsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzdCLENBQUM7Q0FDSjtBQW5URCw0QkFtVEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBsb2c0anMgZnJvbSAna29hLWxvZzQnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcbmltcG9ydCB7IGRlbCwgZ2V0LCBwYXRjaCwgcG9zdCwgcHV0IH0gZnJvbSAncmVxdWVzdCc7XG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJztcbmltcG9ydCBDQUh0dHBzQ29udGV4dCBmcm9tICcuLi9tb2RlbHMvQ0FIdHRwc0NvbnRleHQnO1xuXG5jb25zdCBfbG9nID0gbG9nNGpzLmdldExvZ2dlcignQVBJTWFuZ2VyJyk7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBUElNYW5nZXIge1xuICAgIHByaXZhdGUgYWdlbnRPcHRpb25zOiB1bmRlZmluZWQgfCB7XG4gICAgICAgIGNlcnRGaWxlPzogc3RyaW5nLFxuICAgICAgICBrZXlGaWxlPzogc3RyaW5nLFxuICAgICAgICBjYT86IHN0cmluZyxcbiAgICAgICAgcGFzc3BocmFzZT86IHN0cmluZyxcbiAgICAgICAgc2VjdXJpdHlPcHRpb25zPzogc3RyaW5nLFxuICAgICAgICBzZWN1cmVQcm90b2NvbD86IHN0cmluZ1xuICAgIH0gPSB1bmRlZmluZWQ7XG4gICAgcHJpdmF0ZSBhdXRoOiB1bmRlZmluZWQgfCB7XG4gICAgICAgIHVzZXI/OiBzdHJpbmcsXG4gICAgICAgIHBhc3M/OiBzdHJpbmcsXG4gICAgICAgIGJlYXJlcj86IHN0cmluZyxcbiAgICAgICAgc2VuZEltbWVkaWF0ZWx5PzogYm9vbGVhblxuICAgIH07XG4gICAgcHJpdmF0ZSBnZXQ7XG4gICAgcHJpdmF0ZSBkZWw7XG4gICAgcHJpdmF0ZSBwYXRjaDtcbiAgICBwcml2YXRlIHBvc3Q7XG4gICAgcHJpdmF0ZSBwdXQ7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IGNhRGF0YSA9IENBSHR0cHNDb250ZXh0LmdldEluc3RhbmNlKCkuZ2V0Q0EoKTtcbiAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGNhRGF0YSkpIHtcbiAgICAgICAgICAgIHRoaXMuYWdlbnRPcHRpb25zID0gXy5pc1VuZGVmaW5lZChjYURhdGEuY2FkYXRhKSA/IHVuZGVmaW5lZCA6IF8ub21pdEJ5KGNhRGF0YS5jYWRhdGEsIF8uaXNVbmRlZmluZWQpO1xuICAgICAgICAgICAgdGhpcy5hdXRoID0gXy5pc1VuZGVmaW5lZChjYURhdGEuYXV0aERhdGEpID8gdW5kZWZpbmVkIDogXy5vbWl0QnkoY2FEYXRhLmF1dGhEYXRhLCBfLmlzVW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbZ2V0UG0sIHBvc3RQbSwgcGF0Y2hQbSwgZGVsZXRlUG0sIHB1dFBtXSA9IFtnZXQsIHBvc3QsIHBhdGNoLCBkZWwsIHB1dF0ubWFwKHByb21pc2lmeSk7XG4gICAgICAgIHRoaXMuZ2V0ID0gZ2V0UG07XG4gICAgICAgIHRoaXMucG9zdCA9IHBvc3RQbTtcbiAgICAgICAgdGhpcy5wYXRjaCA9IHBhdGNoUG07XG4gICAgICAgIHRoaXMuZGVsID0gZGVsZXRlUG07XG4gICAgICAgIHRoaXMucHV0ID0gcHV0UG07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGh0dHBHZXRcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgaHR0cEdldChcbiAgICAgICAgdXJsOiBzdHJpbmcsXG4gICAgICAgIHBhcmFtcz86IGFueSxcbiAgICAgICAgYXV0aERhdGE/OiB7XG4gICAgICAgICAgICB1c2VyPzogc3RyaW5nLFxuICAgICAgICAgICAgcGFzcz86IHN0cmluZyxcbiAgICAgICAgICAgIGJlYXJlcj86IHN0cmluZyxcbiAgICAgICAgICAgIHNlbmRJbW1lZGlhdGVseT86IGJvb2xlYW5cbiAgICAgICAgfSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGJhc2VEYXRhID0ge1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovLycgKyB1cmwsXG4gICAgICAgICAgICBhdXRoOiBfLmlzVW5kZWZpbmVkKGF1dGhEYXRhKSA/IHRoaXMuYXV0aCA6IGF1dGhEYXRhXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlcURhdGEgPSBfLmlzVW5kZWZpbmVkKHBhcmFtcykgPyBiYXNlRGF0YSA6IF8uYXNzaWduKGJhc2VEYXRhLCB7IHFzOiBwYXJhbXMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChyZXFEYXRhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaHR0cHNHZXRcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgaHR0cHNHZXQoXG4gICAgICAgIHVybDogc3RyaW5nLCBwYXJhbXM/OiBhbnksXG4gICAgICAgIGNhZGF0YT86IHtcbiAgICAgICAgICAgIGNlcnRGaWxlPzogc3RyaW5nLFxuICAgICAgICAgICAga2V5RmlsZT86IHN0cmluZyxcbiAgICAgICAgICAgIGNhPzogc3RyaW5nLFxuICAgICAgICAgICAgcGFzc3BocmFzZT86IHN0cmluZyxcbiAgICAgICAgICAgIHNlY3VyaXR5T3B0aW9ucz86IHN0cmluZyxcbiAgICAgICAgICAgIHNlY3VyZVByb3RvY29sPzogc3RyaW5nXG4gICAgICAgIH0pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBiYXNlRGF0YSA9IHtcbiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly8nICsgdXJsLFxuICAgICAgICAgICAgYWdlbnRPcHRpb25zOiBfLmlzVW5kZWZpbmVkKGNhZGF0YSkgPyB0aGlzLmFnZW50T3B0aW9ucyA6IF8ub21pdEJ5KGNhZGF0YSwgXy5pc1VuZGVmaW5lZClcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVxRGF0YSA9IF8uaXNVbmRlZmluZWQocGFyYW1zKSA/IGJhc2VEYXRhIDogXy5hc3NpZ24oYmFzZURhdGEsIHsgcXM6IHBhcmFtcyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHJlcURhdGEpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBodHRwUG9zdFxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBodHRwUG9zdChcbiAgICAgICAgdXJsOiBzdHJpbmcsIHJlcXVlc3RCb2R5LCBwYXJhbXM/OiBhbnksIGF1dGhEYXRhPzoge1xuICAgICAgICAgICAgdXNlcj86IHN0cmluZyxcbiAgICAgICAgICAgIHBhc3M/OiBzdHJpbmcsXG4gICAgICAgICAgICBiZWFyZXI/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZW5kSW1tZWRpYXRlbHk/OiBib29sZWFuXG4gICAgICAgIH0pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBiYXNlRGF0YSA9IHtcbiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly8nICsgdXJsLFxuICAgICAgICAgICAgYXV0aDogXy5pc1VuZGVmaW5lZChhdXRoRGF0YSkgPyB0aGlzLmF1dGggOiBhdXRoRGF0YSxcbiAgICAgICAgICAgIGpzb246IHRydWUsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVxRGF0YSA9IF8uaXNVbmRlZmluZWQocGFyYW1zKSA/IGJhc2VEYXRhIDogXy5hc3NpZ24oYmFzZURhdGEsIHsgcXM6IHBhcmFtcyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdChyZXFEYXRhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaHR0cHNQb3N0XG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGh0dHBzUG9zdChcbiAgICAgICAgdXJsOiBzdHJpbmcsIHJlcXVlc3RCb2R5LCBwYXJhbXM/OiBhbnksXG4gICAgICAgIGNhZGF0YT86IHtcbiAgICAgICAgICAgIGNlcnRGaWxlPzogc3RyaW5nLFxuICAgICAgICAgICAga2V5RmlsZT86IHN0cmluZyxcbiAgICAgICAgICAgIGNhPzogc3RyaW5nLFxuICAgICAgICAgICAgcGFzc3BocmFzZT86IHN0cmluZyxcbiAgICAgICAgICAgIHNlY3VyaXR5T3B0aW9ucz86IHN0cmluZyxcbiAgICAgICAgICAgIHNlY3VyZVByb3RvY29sPzogc3RyaW5nXG4gICAgICAgIH0pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBiYXNlRGF0YSA9IHtcbiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly8nICsgdXJsLFxuICAgICAgICAgICAgYWdlbnRPcHRpb25zOiBfLmlzVW5kZWZpbmVkKGNhZGF0YSkgPyB0aGlzLmFnZW50T3B0aW9ucyA6IF8ub21pdEJ5KGNhZGF0YSwgXy5pc1VuZGVmaW5lZCksXG4gICAgICAgICAgICBqc29uOiB0cnVlLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVxRGF0YSA9IF8uaXNVbmRlZmluZWQocGFyYW1zKSA/IGJhc2VEYXRhIDogXy5hc3NpZ24oYmFzZURhdGEsIHsgcXM6IHBhcmFtcyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdChyZXFEYXRhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaHR0cFBvc3RGb3JtRGF0YVxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBodHRwUG9zdEZvcm1EYXRhKFxuICAgICAgICB1cmw6IHN0cmluZywgZm9ybURhdGEsIHBhcmFtcz86IGFueSwgYXV0aERhdGE/OiB7XG4gICAgICAgICAgICB1c2VyPzogc3RyaW5nLFxuICAgICAgICAgICAgcGFzcz86IHN0cmluZyxcbiAgICAgICAgICAgIGJlYXJlcj86IHN0cmluZyxcbiAgICAgICAgICAgIHNlbmRJbW1lZGlhdGVseT86IGJvb2xlYW5cbiAgICAgICAgfSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGJhc2VEYXRhID0ge1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovLycgKyB1cmwsXG4gICAgICAgICAgICBhdXRoOiBfLmlzVW5kZWZpbmVkKGF1dGhEYXRhKSA/IHRoaXMuYXV0aCA6IGF1dGhEYXRhLFxuICAgICAgICAgICAgZm9ybURhdGFcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVxRGF0YSA9IF8uaXNVbmRlZmluZWQocGFyYW1zKSA/IGJhc2VEYXRhIDogXy5hc3NpZ24oYmFzZURhdGEsIHsgcXM6IHBhcmFtcyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdChyZXFEYXRhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaHR0cHNQb3N0Rm9ybURhdGFcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgaHR0cHNQb3N0Rm9ybURhdGEoXG4gICAgICAgIHVybDogc3RyaW5nLCBmb3JtRGF0YSwgcGFyYW1zPzogYW55LFxuICAgICAgICBjYWRhdGE/OiB7XG4gICAgICAgICAgICBjZXJ0RmlsZT86IHN0cmluZyxcbiAgICAgICAgICAgIGtleUZpbGU/OiBzdHJpbmcsXG4gICAgICAgICAgICBjYT86IHN0cmluZyxcbiAgICAgICAgICAgIHBhc3NwaHJhc2U/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cml0eU9wdGlvbnM/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cmVQcm90b2NvbD86IHN0cmluZ1xuICAgICAgICB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgYmFzZURhdGEgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vJyArIHVybCxcbiAgICAgICAgICAgIGFnZW50T3B0aW9uczogXy5pc1VuZGVmaW5lZChjYWRhdGEpID8gdGhpcy5hZ2VudE9wdGlvbnMgOiBfLm9taXRCeShjYWRhdGEsIF8uaXNVbmRlZmluZWQpLFxuICAgICAgICAgICAgZm9ybURhdGFcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVxRGF0YSA9IF8uaXNVbmRlZmluZWQocGFyYW1zKSA/IGJhc2VEYXRhIDogXy5hc3NpZ24oYmFzZURhdGEsIHsgcXM6IHBhcmFtcyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdChyZXFEYXRhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogaHR0cFB1dFxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBodHRwUHV0KFxuICAgICAgICB1cmw6IHN0cmluZywgcmVxdWVzdEJvZHksIHBhcmFtcz86IGFueSxcbiAgICAgICAgYXV0aERhdGE/OiB7XG4gICAgICAgICAgICB1c2VyPzogc3RyaW5nLFxuICAgICAgICAgICAgcGFzcz86IHN0cmluZyxcbiAgICAgICAgICAgIGJlYXJlcj86IHN0cmluZyxcbiAgICAgICAgICAgIHNlbmRJbW1lZGlhdGVseT86IGJvb2xlYW5cbiAgICAgICAgfSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGJhc2VEYXRhID0ge1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovLycgKyB1cmwsXG4gICAgICAgICAgICBhdXRoOiBfLmlzVW5kZWZpbmVkKGF1dGhEYXRhKSA/IHRoaXMuYXV0aCA6IGF1dGhEYXRhLFxuICAgICAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXFEYXRhID0gXy5pc1VuZGVmaW5lZChwYXJhbXMpID8gYmFzZURhdGEgOiBfLmFzc2lnbihiYXNlRGF0YSwgeyBxczogcGFyYW1zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5wdXQocmVxRGF0YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGh0dHBzUHV0XG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGh0dHBzUHV0KFxuICAgICAgICB1cmw6IHN0cmluZywgcmVxdWVzdEJvZHksIHBhcmFtcz86IGFueSxcbiAgICAgICAgY2FkYXRhPzoge1xuICAgICAgICAgICAgY2VydEZpbGU/OiBzdHJpbmcsXG4gICAgICAgICAgICBrZXlGaWxlPzogc3RyaW5nLFxuICAgICAgICAgICAgY2E/OiBzdHJpbmcsXG4gICAgICAgICAgICBwYXNzcGhyYXNlPzogc3RyaW5nLFxuICAgICAgICAgICAgc2VjdXJpdHlPcHRpb25zPzogc3RyaW5nLFxuICAgICAgICAgICAgc2VjdXJlUHJvdG9jb2w/OiBzdHJpbmdcbiAgICAgICAgfSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGJhc2VEYXRhID0ge1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovLycgKyB1cmwsXG4gICAgICAgICAgICBhZ2VudE9wdGlvbnM6IF8uaXNVbmRlZmluZWQoY2FkYXRhKSA/IHRoaXMuYWdlbnRPcHRpb25zIDogXy5vbWl0QnkoY2FkYXRhLCBfLmlzVW5kZWZpbmVkKSxcbiAgICAgICAgICAgIGpzb246IHRydWUsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXFEYXRhID0gXy5pc1VuZGVmaW5lZChwYXJhbXMpID8gYmFzZURhdGEgOiBfLmFzc2lnbihiYXNlRGF0YSwgeyBxczogcGFyYW1zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5wdXQocmVxRGF0YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGh0dHBQdXRGb3JtRGF0YVxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBodHRwUHV0Rm9ybURhdGEoXG4gICAgICAgIHVybDogc3RyaW5nLCBmb3JtRGF0YSwgcGFyYW1zPzogYW55LCBhdXRoRGF0YT86IHtcbiAgICAgICAgICAgIHVzZXI/OiBzdHJpbmcsXG4gICAgICAgICAgICBwYXNzPzogc3RyaW5nLFxuICAgICAgICAgICAgYmVhcmVyPzogc3RyaW5nLFxuICAgICAgICAgICAgc2VuZEltbWVkaWF0ZWx5PzogYm9vbGVhblxuICAgICAgICB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgYmFzZURhdGEgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vJyArIHVybCxcbiAgICAgICAgICAgIGF1dGg6IF8uaXNVbmRlZmluZWQoYXV0aERhdGEpID8gdGhpcy5hdXRoIDogYXV0aERhdGEsXG4gICAgICAgICAgICBmb3JtRGF0YVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXFEYXRhID0gXy5pc1VuZGVmaW5lZChwYXJhbXMpID8gYmFzZURhdGEgOiBfLmFzc2lnbihiYXNlRGF0YSwgeyBxczogcGFyYW1zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5wdXQocmVxRGF0YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGh0dHBzUHV0XG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGh0dHBzUHV0Rm9ybURhdGEoXG4gICAgICAgIHVybDogc3RyaW5nLCBmb3JtRGF0YSwgcGFyYW1zPzogYW55LFxuICAgICAgICBjYWRhdGE/OiB7XG4gICAgICAgICAgICBjZXJ0RmlsZT86IHN0cmluZyxcbiAgICAgICAgICAgIGtleUZpbGU/OiBzdHJpbmcsXG4gICAgICAgICAgICBjYT86IHN0cmluZyxcbiAgICAgICAgICAgIHBhc3NwaHJhc2U/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cml0eU9wdGlvbnM/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cmVQcm90b2NvbD86IHN0cmluZ1xuICAgICAgICB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgYmFzZURhdGEgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vJyArIHVybCxcbiAgICAgICAgICAgIGFnZW50T3B0aW9uczogXy5pc1VuZGVmaW5lZChjYWRhdGEpID8gdGhpcy5hZ2VudE9wdGlvbnMgOiBfLm9taXRCeShjYWRhdGEsIF8uaXNVbmRlZmluZWQpLCBmb3JtRGF0YVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXFEYXRhID0gXy5pc1VuZGVmaW5lZChwYXJhbXMpID8gYmFzZURhdGEgOiBfLmFzc2lnbihiYXNlRGF0YSwgeyBxczogcGFyYW1zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5wdXQocmVxRGF0YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGh0dHBQYXRjaFxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBodHRwUGF0Y2goXG4gICAgICAgIHVybDogc3RyaW5nLCByZXF1ZXN0Qm9keSwgcGFyYW1zPzogYW55LCBhdXRoRGF0YT86IHtcbiAgICAgICAgICAgIHVzZXI/OiBzdHJpbmcsXG4gICAgICAgICAgICBwYXNzPzogc3RyaW5nLFxuICAgICAgICAgICAgYmVhcmVyPzogc3RyaW5nLFxuICAgICAgICAgICAgc2VuZEltbWVkaWF0ZWx5PzogYm9vbGVhblxuICAgICAgICB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgYmFzZURhdGEgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vJyArIHVybCxcbiAgICAgICAgICAgIGF1dGg6IF8uaXNVbmRlZmluZWQoYXV0aERhdGEpID8gdGhpcy5hdXRoIDogYXV0aERhdGEsXG4gICAgICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlcURhdGEgPSBfLmlzVW5kZWZpbmVkKHBhcmFtcykgPyBiYXNlRGF0YSA6IF8uYXNzaWduKGJhc2VEYXRhLCB7IHFzOiBwYXJhbXMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGNoKHJlcURhdGEpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBodHRwc1BhdGNoXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGh0dHBzUGF0Y2goXG4gICAgICAgIHVybDogc3RyaW5nLCByZXF1ZXN0Qm9keSwgcGFyYW1zPzogYW55LFxuICAgICAgICBjYWRhdGE/OiB7XG4gICAgICAgICAgICBjZXJ0RmlsZT86IHN0cmluZyxcbiAgICAgICAgICAgIGtleUZpbGU/OiBzdHJpbmcsXG4gICAgICAgICAgICBjYT86IHN0cmluZyxcbiAgICAgICAgICAgIHBhc3NwaHJhc2U/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cml0eU9wdGlvbnM/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cmVQcm90b2NvbD86IHN0cmluZ1xuICAgICAgICB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgYmFzZURhdGEgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vJyArIHVybCxcbiAgICAgICAgICAgIGFnZW50T3B0aW9uczogXy5pc1VuZGVmaW5lZChjYWRhdGEpID8gdGhpcy5hZ2VudE9wdGlvbnMgOiBfLm9taXRCeShjYWRhdGEsIF8uaXNVbmRlZmluZWQpLFxuICAgICAgICAgICAganNvbjogdHJ1ZSwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlcURhdGEgPSBfLmlzVW5kZWZpbmVkKHBhcmFtcykgPyBiYXNlRGF0YSA6IF8uYXNzaWduKGJhc2VEYXRhLCB7IHFzOiBwYXJhbXMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGNoKHJlcURhdGEpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBodHRwRGVsZXRlXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGh0dHBEZWxldGUoXG4gICAgICAgIHVybDogc3RyaW5nLCBwYXJhbXM/OiBhbnksIGF1dGhEYXRhPzoge1xuICAgICAgICAgICAgdXNlcj86IHN0cmluZyxcbiAgICAgICAgICAgIHBhc3M/OiBzdHJpbmcsXG4gICAgICAgICAgICBiZWFyZXI/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZW5kSW1tZWRpYXRlbHk/OiBib29sZWFuXG4gICAgICAgIH0pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBiYXNlRGF0YSA9IHtcbiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly8nICsgdXJsLFxuICAgICAgICAgICAgYXV0aDogXy5pc1VuZGVmaW5lZChhdXRoRGF0YSkgPyB0aGlzLmF1dGggOiBhdXRoRGF0YVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXFEYXRhID0gXy5pc1VuZGVmaW5lZChwYXJhbXMpID8gYmFzZURhdGEgOiBfLmFzc2lnbihiYXNlRGF0YSwgeyBxczogcGFyYW1zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5kZWwocmVxRGF0YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGh0dHBzRGVsZXRlXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGh0dHBzRGVsZXRlKFxuICAgICAgICB1cmw6IHN0cmluZywgcGFyYW1zPzogYW55LFxuICAgICAgICBjYWRhdGE/OiB7XG4gICAgICAgICAgICBjZXJ0RmlsZT86IHN0cmluZyxcbiAgICAgICAgICAgIGtleUZpbGU/OiBzdHJpbmcsXG4gICAgICAgICAgICBjYT86IHN0cmluZyxcbiAgICAgICAgICAgIHBhc3NwaHJhc2U/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cml0eU9wdGlvbnM/OiBzdHJpbmcsXG4gICAgICAgICAgICBzZWN1cmVQcm90b2NvbD86IHN0cmluZ1xuICAgICAgICB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgYmFzZURhdGEgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vJyArIHVybCxcbiAgICAgICAgICAgIGFnZW50T3B0aW9uczogXy5pc1VuZGVmaW5lZChjYWRhdGEpID8gdGhpcy5hZ2VudE9wdGlvbnMgOiBfLm9taXRCeShjYWRhdGEsIF8uaXNVbmRlZmluZWQpXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlcURhdGEgPSBfLmlzVW5kZWZpbmVkKHBhcmFtcykgPyBiYXNlRGF0YSA6IF8uYXNzaWduKGJhc2VEYXRhLCB7IHFzOiBwYXJhbXMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbChyZXFEYXRhKTtcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUhUVFBTQ0Ege1xuICAgIGNhZGF0YT86IHtcbiAgICAgICAgY2VydEZpbGU/OiBzdHJpbmcsXG4gICAgICAgIGtleUZpbGU/OiBzdHJpbmcsXG4gICAgICAgIGNhPzogc3RyaW5nLFxuICAgICAgICBwYXNzcGhyYXNlPzogc3RyaW5nLFxuICAgICAgICBzZWN1cml0eU9wdGlvbnM/OiBzdHJpbmcsXG4gICAgICAgIHNlY3VyZVByb3RvY29sPzogc3RyaW5nXG4gICAgfTtcbiAgICBhdXRoRGF0YToge1xuICAgICAgICB1c2VyPzogc3RyaW5nLFxuICAgICAgICBwYXNzPzogc3RyaW5nLFxuICAgICAgICBiZWFyZXI/OiBzdHJpbmcsXG4gICAgICAgIHNlbmRJbW1lZGlhdGVseT86IGJvb2xlYW5cbiAgICB9O1xufVxuIl19