"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Koa = require("koa");
const jwt = require("koa-jwt");
const log4js = require("koa-log4");
const WebSocketContext_1 = require("./models/WebSocketContext");
const log = log4js.getLogger('WSServer');
let privateKey;
let active;
let port;
function Init(_privateKey, _active, _port) {
    privateKey = _privateKey;
    active = _active;
    port = _port;
}
exports.Init = Init;
function Worker() {
    const wss = this.wss;
    const server = this.server;
    const app = new Koa();
    app.use(jwt({ secret: privateKey, passthrough: !active }));
    server.on('request', app.callback());
    WebSocketContext_1.default.init(wss);
    log.info('WebSocket started listening on ws://localhost:%s ...', port);
}
exports.Worker = Worker;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV1NTZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJXU1NlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJCQUEyQjtBQUMzQiwrQkFBK0I7QUFDL0IsbUNBQW1DO0FBQ25DLGdFQUF5RDtBQUV6RCxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3pDLElBQUksVUFBVSxDQUFDO0FBQ2YsSUFBSSxNQUFNLENBQUM7QUFDWCxJQUFJLElBQUksQ0FBQztBQUNULFNBQWdCLElBQUksQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUFFLEtBQUs7SUFDNUMsVUFBVSxHQUFHLFdBQVcsQ0FBQztJQUN6QixNQUFNLEdBQUcsT0FBTyxDQUFDO0lBQ2pCLElBQUksR0FBRyxLQUFLLENBQUM7QUFDakIsQ0FBQztBQUpELG9CQUlDO0FBQ0QsU0FBZ0IsTUFBTTtJQUNsQixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3JCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDM0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN0QixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzNELE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLDBCQUFnQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMzQixHQUFHLENBQUMsSUFBSSxDQUFDLHNEQUFzRCxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzNFLENBQUM7QUFSRCx3QkFRQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEtvYSBmcm9tICdrb2EnO1xuaW1wb3J0ICogYXMgand0IGZyb20gJ2tvYS1qd3QnO1xuaW1wb3J0ICogYXMgbG9nNGpzIGZyb20gJ2tvYS1sb2c0JztcbmltcG9ydCBXZWJTb2NrZXRDb250ZXh0IGZyb20gJy4vbW9kZWxzL1dlYlNvY2tldENvbnRleHQnO1xuXG5jb25zdCBsb2cgPSBsb2c0anMuZ2V0TG9nZ2VyKCdXU1NlcnZlcicpO1xubGV0IHByaXZhdGVLZXk7XG5sZXQgYWN0aXZlO1xubGV0IHBvcnQ7XG5leHBvcnQgZnVuY3Rpb24gSW5pdChfcHJpdmF0ZUtleSwgX2FjdGl2ZSwgX3BvcnQpIHtcbiAgICBwcml2YXRlS2V5ID0gX3ByaXZhdGVLZXk7XG4gICAgYWN0aXZlID0gX2FjdGl2ZTtcbiAgICBwb3J0ID0gX3BvcnQ7XG59XG5leHBvcnQgZnVuY3Rpb24gV29ya2VyKCkge1xuICAgIGNvbnN0IHdzcyA9IHRoaXMud3NzO1xuICAgIGNvbnN0IHNlcnZlciA9IHRoaXMuc2VydmVyO1xuICAgIGNvbnN0IGFwcCA9IG5ldyBLb2EoKTtcbiAgICBhcHAudXNlKGp3dCh7IHNlY3JldDogcHJpdmF0ZUtleSwgcGFzc3Rocm91Z2g6ICFhY3RpdmUgfSkpO1xuICAgIHNlcnZlci5vbigncmVxdWVzdCcsIGFwcC5jYWxsYmFjaygpKTtcbiAgICBXZWJTb2NrZXRDb250ZXh0LmluaXQod3NzKTtcbiAgICBsb2cuaW5mbygnV2ViU29ja2V0IHN0YXJ0ZWQgbGlzdGVuaW5nIG9uIHdzOi8vbG9jYWxob3N0OiVzIC4uLicsIHBvcnQpO1xufVxuIl19