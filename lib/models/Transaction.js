"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const log4js = require("koa-log4");
const _ = require("lodash");
require("reflect-metadata");
const MySqlContext_1 = require("./MySqlContext");
const _log = log4js.getLogger('Transaction');
class Transaction {
    constructor(dbName) {
        this.transPromise = MySqlContext_1.default.getInstance().getBean(_.isUndefined(dbName) ? 'main' : dbName);
    }
    async begin() {
        this.trans = await this.transPromise;
        return this.trans.beginTransaction();
    }
    async commit() {
        await this.trans.commit();
        return this.trans.release();
    }
    async rollback() {
        await this.trans.rollback();
        return this.trans.release();
    }
}
exports.default = Transaction;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhbnNhY3Rpb24uanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJtb2RlbHMvVHJhbnNhY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBbUM7QUFDbkMsNEJBQTRCO0FBQzVCLDRCQUEwQjtBQUUxQixpREFBMEM7QUFFMUMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUU3QyxNQUFxQixXQUFXO0lBSTVCLFlBQVksTUFBZTtRQUN2QixJQUFJLENBQUMsWUFBWSxHQUFHLHNCQUFZLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEcsQ0FBQztJQUNNLEtBQUssQ0FBQyxLQUFLO1FBQ2QsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDckMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDekMsQ0FBQztJQUNNLEtBQUssQ0FBQyxNQUFNO1FBQ2YsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzFCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBQ00sS0FBSyxDQUFDLFFBQVE7UUFDakIsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzVCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0NBQ0o7QUFuQkQsOEJBbUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgbG9nNGpzIGZyb20gJ2tvYS1sb2c0JztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBJVHJhbnNhY3Rpb24sIE9STUNvbnRleHQgfSBmcm9tICcuJztcbmltcG9ydCBNeXNxbENvbnRleHQgZnJvbSAnLi9NeVNxbENvbnRleHQnO1xuXG5jb25zdCBfbG9nID0gbG9nNGpzLmdldExvZ2dlcignVHJhbnNhY3Rpb24nKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhbnNhY3Rpb24gaW1wbGVtZW50cyBJVHJhbnNhY3Rpb24ge1xuICAgIFt4OiBzdHJpbmddOiBhbnk7XG4gICAgcHJpdmF0ZSB0cmFuc1Byb21pc2U6IFByb21pc2U8YW55PjtcbiAgICBwcml2YXRlIHRyYW5zOiBhbnk7XG4gICAgY29uc3RydWN0b3IoZGJOYW1lPzogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudHJhbnNQcm9taXNlID0gTXlzcWxDb250ZXh0LmdldEluc3RhbmNlKCkuZ2V0QmVhbihfLmlzVW5kZWZpbmVkKGRiTmFtZSkgPyAnbWFpbicgOiBkYk5hbWUpO1xuICAgIH1cbiAgICBwdWJsaWMgYXN5bmMgYmVnaW4oKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgdGhpcy50cmFucyA9IGF3YWl0IHRoaXMudHJhbnNQcm9taXNlO1xuICAgICAgICByZXR1cm4gdGhpcy50cmFucy5iZWdpblRyYW5zYWN0aW9uKCk7XG4gICAgfVxuICAgIHB1YmxpYyBhc3luYyBjb21taXQoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgYXdhaXQgdGhpcy50cmFucy5jb21taXQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnMucmVsZWFzZSgpO1xuICAgIH1cbiAgICBwdWJsaWMgYXN5bmMgcm9sbGJhY2soKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgYXdhaXQgdGhpcy50cmFucy5yb2xsYmFjaygpO1xuICAgICAgICByZXR1cm4gdGhpcy50cmFucy5yZWxlYXNlKCk7XG4gICAgfVxufVxuIl19