"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const log4js = require("koa-log4");
const _log = log4js.getLogger('WebSocketContext');
class WebSocketContext {
    constructor() { }
    static getInstance() {
        return WebSocketContext._instance;
    }
    getWebsocket() {
        return WebSocketContext._websocket;
    }
    static init(websocket) {
        WebSocketContext._websocket = websocket;
        websocket.on('connection', (ws, req, head) => {
            console.log(req.connection.remoteAddress);
            ws.on('disconnect', (code, reason) => {
                _log.info('disconnect');
            });
            ws.on('error', (err) => {
                _log.error('error', err);
                throw err;
            });
        });
        websocket.setMiddleware('onPublish', (channel, data) => {
            _log.info('data', data);
        });
    }
}
WebSocketContext._instance = new WebSocketContext();
exports.default = WebSocketContext;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0Q29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIuL3NyYy8iLCJzb3VyY2VzIjpbIm1vZGVscy9XZWJTb2NrZXRDb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUNBQW1DO0FBR25DLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNsRCxNQUFxQixnQkFBZ0I7SUFPakMsZ0JBQXVCLENBQUM7SUFMakIsTUFBTSxDQUFDLFdBQVc7UUFDdkIsT0FBTyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUM7SUFDcEMsQ0FBQztJQUlNLFlBQVk7UUFDakIsT0FBTyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFDckMsQ0FBQztJQUNNLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUztRQUMxQixnQkFBZ0IsQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1FBQ3hDLFNBQVMsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDMUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFZLEVBQUUsTUFBYyxFQUFRLEVBQUU7Z0JBQ3ZELElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUM7WUFDSCxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQVUsRUFBRSxFQUFFO2dCQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDekIsTUFBTSxHQUFHLENBQUM7WUFDZCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsU0FBUyxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFlLEVBQUUsSUFBUyxFQUFRLEVBQUU7WUFDeEUsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOztBQXpCYywwQkFBUyxHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztBQUR0RCxtQ0EyQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBsb2c0anMgZnJvbSAna29hLWxvZzQnO1xuaW1wb3J0ICogYXMgV2ViU29ja2V0IGZyb20gJ3dzJztcblxuY29uc3QgX2xvZyA9IGxvZzRqcy5nZXRMb2dnZXIoJ1dlYlNvY2tldENvbnRleHQnKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdlYlNvY2tldENvbnRleHQge1xuICAgIHByaXZhdGUgc3RhdGljIF9pbnN0YW5jZSA9IG5ldyBXZWJTb2NrZXRDb250ZXh0KCk7XG4gICAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBXZWJTb2NrZXRDb250ZXh0IHtcbiAgICAgIHJldHVybiBXZWJTb2NrZXRDb250ZXh0Ll9pbnN0YW5jZTtcbiAgICB9XG4gICAgcHJpdmF0ZSBzdGF0aWMgX3dlYnNvY2tldDtcbiAgICBwcml2YXRlIHN0YXRpYyBpc0FsaXZlOiBhbnk7XG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHt9XG4gICAgcHVibGljIGdldFdlYnNvY2tldCgpOiBXZWJTb2NrZXQuU2VydmVyIHtcbiAgICAgIHJldHVybiBXZWJTb2NrZXRDb250ZXh0Ll93ZWJzb2NrZXQ7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgaW5pdCh3ZWJzb2NrZXQpIHtcbiAgICAgIFdlYlNvY2tldENvbnRleHQuX3dlYnNvY2tldCA9IHdlYnNvY2tldDtcbiAgICAgIHdlYnNvY2tldC5vbignY29ubmVjdGlvbicsICh3cywgcmVxLCBoZWFkKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcS5jb25uZWN0aW9uLnJlbW90ZUFkZHJlc3MpO1xuICAgICAgICB3cy5vbignZGlzY29ubmVjdCcsIChjb2RlOiBudW1iZXIsIHJlYXNvbjogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICAgICAgICBfbG9nLmluZm8oJ2Rpc2Nvbm5lY3QnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHdzLm9uKCdlcnJvcicsIChlcnI6IEVycm9yKSA9PiB7XG4gICAgICAgICAgICBfbG9nLmVycm9yKCdlcnJvcicsIGVycik7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB3ZWJzb2NrZXQuc2V0TWlkZGxld2FyZSgnb25QdWJsaXNoJywgKGNoYW5uZWw6IHN0cmluZywgZGF0YTogYW55KTogdm9pZCA9PiB7XG4gICAgICAgIF9sb2cuaW5mbygnZGF0YScsIGRhdGEpO1xuICAgICAgfSk7XG4gICAgfVxufVxuIl19