"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const log4js = require("koa-log4");
require("reflect-metadata");
const WsEntity_1 = require("./WsEntity");
const _log = log4js.getLogger('WebSocketContext');
class WebSocketContext {
    constructor() { }
    static getInstance() {
        return WebSocketContext._instance;
    }
    getWebsocket() {
        return WebSocketContext._instance._websocket;
    }
    static init(websocket) {
        WebSocketContext._instance._websocket = websocket;
    }
    onConnection(fun) {
        return WebSocketContext._instance._websocket.on('connection', (ws, req, head) => {
            fun(new WsEntity_1.default(ws), req, head);
        });
    }
}
WebSocketContext._instance = new WebSocketContext();
exports.default = WebSocketContext;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0Q29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIuL3NyYy8iLCJzb3VyY2VzIjpbIm1vZGVscy9XZWJTb2NrZXRDb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUNBQW1DO0FBRW5DLDRCQUEwQjtBQUMxQix5Q0FBa0M7QUFFbEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2xELE1BQXFCLGdCQUFnQjtJQU1qQyxnQkFBd0IsQ0FBQztJQUpsQixNQUFNLENBQUMsV0FBVztRQUNyQixPQUFPLGdCQUFnQixDQUFDLFNBQVMsQ0FBQztJQUN0QyxDQUFDO0lBR00sWUFBWTtRQUNmLE9BQU8sZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQztJQUNqRCxDQUFDO0lBQ00sTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTO1FBQ3hCLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO0lBQ3RELENBQUM7SUFDTSxZQUFZLENBQUMsR0FBNEI7UUFDNUMsT0FBTyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO1lBQzVFLEdBQUcsQ0FBQyxJQUFJLGtCQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7QUFoQmMsMEJBQVMsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUM7QUFEdEQsbUNBa0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgbG9nNGpzIGZyb20gJ2tvYS1sb2c0JztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgV3NFbnRpdHkgZnJvbSAnLi9Xc0VudGl0eSc7XG5cbmNvbnN0IF9sb2cgPSBsb2c0anMuZ2V0TG9nZ2VyKCdXZWJTb2NrZXRDb250ZXh0Jyk7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWJTb2NrZXRDb250ZXh0IHtcbiAgICBwcml2YXRlIHN0YXRpYyBfaW5zdGFuY2UgPSBuZXcgV2ViU29ja2V0Q29udGV4dCgpO1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogV2ViU29ja2V0Q29udGV4dCB7XG4gICAgICAgIHJldHVybiBXZWJTb2NrZXRDb250ZXh0Ll9pbnN0YW5jZTtcbiAgICB9XG4gICAgcHJpdmF0ZSBfd2Vic29ja2V0O1xuICAgIHByaXZhdGUgY29uc3RydWN0b3IoKSB7IH1cbiAgICBwdWJsaWMgZ2V0V2Vic29ja2V0KCk6IGFueSB7XG4gICAgICAgIHJldHVybiBXZWJTb2NrZXRDb250ZXh0Ll9pbnN0YW5jZS5fd2Vic29ja2V0O1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGluaXQod2Vic29ja2V0KSB7XG4gICAgICAgIFdlYlNvY2tldENvbnRleHQuX2luc3RhbmNlLl93ZWJzb2NrZXQgPSB3ZWJzb2NrZXQ7XG4gICAgfVxuICAgIHB1YmxpYyBvbkNvbm5lY3Rpb24oZnVuOiAod3MsIHJlcSwgaGVhZCkgPT4gdm9pZCk6IGFueSB7XG4gICAgICAgIHJldHVybiBXZWJTb2NrZXRDb250ZXh0Ll9pbnN0YW5jZS5fd2Vic29ja2V0Lm9uKCdjb25uZWN0aW9uJywgKHdzLCByZXEsIGhlYWQpID0+IHtcbiAgICAgICAgICAgIGZ1bihuZXcgV3NFbnRpdHkod3MpLCByZXEsIGhlYWQpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=